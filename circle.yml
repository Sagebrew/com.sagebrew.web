machine:
  services:
    - rabbitmq-server

dependencies:
  cache_directories:
    - elasticsearch-1.3.2
  post:
    - pip install -r ../requirements/base.txt
    - sudo chown ubuntu /etc/rsyslog.d/
    - ~/virtualenvs/venv-system/bin/python ~/com.sagebrew.web/sagebrew/manage.py logglypopulation $LOG_ACCOUNT $LOG_TOKEN
    - sudo chown root /etc/rsyslog.d/
    - sudo service rsyslog restart
    - if [[ ! -e elasticsearch-1.3.2 ]]; then wget https://download.elasticsearch.org/elasticsearch/elasticsearch/elasticsearch-1.3.2.tar.gz && tar -xvf elasticsearch-1.3.2.tar.gz; fi
    - elasticsearch-1.3.2/bin/elasticsearch: {background: true}
    - cd ~/com.sagebrew.web/sagebrew && ~/virtualenvs/venv-system/bin/celery -A sagebrew worker -l info -n worker1:
        background: true
    - cd ~/com.sagebrew.web/sagebrew && ~/virtualenvs/venv-system/bin/celery -A sagebrew worker -l info -n worker2:
        background: true
    - cd ~/com.sagebrew.web/sagebrew && ~/virtualenvs/venv-system/bin/celery -A sagebrew beat -l info:
        background: true
    - python ~/com.sagebrew.web/sagebrew/manage.py runserver 127.0.0.1:8080:
        background: true
    - ~/virtualenvs/venv-system/bin/python ~/com.sagebrew.web/sagebrew/manage.py clear_neo_db


checkout:
  post:
    - git submodule sync
    - git submodule update --init

general:
  build_dir: sagebrew

