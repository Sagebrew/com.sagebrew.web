machine:
  services:
    - rabbitmq-server
    - elasticsearch
  post:
    - cd ~/com.sagebrew.web/sagebrew && ~/virtualenvs/venv-system/bin/celery -A sagebrew worker -l info -n worker1:
        background: true
    - cd ~/com.sagebrew.web/sagebrew && ~/virtualenvs/venv-system/bin/celery -A sagebrew worker -l info -n worker1:
        background: true
    - python ~/com.sagebrew.web/sagebrew/manage.py runserver 127.0.0.1:8080:
        background: true
    - sudo chown ubuntu /etc/rsyslog.d/
    - ~/virtualenvs/venv-system/bin/python ~/com.sagebrew.web/sagebrew/manage.py logglypopulation
    - sudo chown root /etc/rsyslog.d/
    - sudo service rsyslog restart


dependencies:
  post:
    - pip install -r ../requirements/web/base.txt
    - pip install git+https://github.com/robinedwards/neomodel.git@0.3.6

checkout:
  post:
    - git submodule sync
    - git submodule update --init

general:
  build_dir: sagebrew

