{% extends 'base.html' %}
<!-- Because this .html file extends an html file with '
    js/query_questions.js' it will cause a 400 error
    from one of the views. We can fix this by not having this html
    extend html that includes 'js/query_questions.js' -->
{% load staticfiles %}
{% block title %}{{ title }}{% endblock title %}
{% block description %}
    <meta name="fragment" content="!">
    <meta name="description" content="{{ description }}">
{% endblock description %}
{% block keywords %}
    {% if tags %}
        <meta name="keywords" content="{{ tags|join:", "|title}}">
    {% endif %}
    <meta name="author" content="{{ authors }}">
{% endblock keywords %}
{% block content %}
<div class="action" style="display: none" data-action="write_question"></div>
<div class="action" style="display: none" data-action="write_comment"></div>
<div class="action" style="display: none" data-action="write_solution"></div>
<div class="sb_page">
    <div class="row-fluid">
        <div class="col-lg-9">
            <div class="sb_wall sb_conversation_wall">
                <h3>
                <a href="{% url 'question_page'%}">
                   Conversations
                </a>
                    </h3>
                <div class="sb_border sb_border_question">
                    <h3>Question</h3>
                {% if to_be_deleted == True %}
                    <div class="row">
                            <div class="col-xs-10">
                                <div>
                                    <h1>
                                        Sorry, the creator of this question has deleted it!
                                    </h1>
                                </div>
                            </div>
                    </div>
                {% else %}
                    <div class="row">
                        {% if html_snapshot %}
                            {% include "question.html" %}
                        {% else %}
                            <div id="single_question_wrapper">
                            </div>
                        {% endif %}
                    </div>
                    <div class="row sb_tertiary_nav">
                        <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
                            {% if html_snapshot %}
                                <h3><span id="solution_count">{{ solution_count }}</span> Solution<span id="solution_plural"></span></h3>
                            {% else %}
                                <h3 id="js-solution-count-header"><span id="solution_count">--</span> Solution<span id="solution_plural"></span></h3>
                            {% endif %}
                        </div>
                      {% if debug %}
                        <div class="col-sm-9 hidden-xs" align="right">
                            <a class="btn sb_tab_question active"
                               data-sort_by="most_recent">Most Recent</a>
                            <a class="btn sb_tab_question"
                               data-sort_by="least_recent">Least Recent</a>
                        </div>
                      {% endif %}
                    </div>
                    <div class="row">
                        {% if html_snapshot %}
                            <div class="col-lg-12" id="solution_container">
                                {% for solution in solutions %}
                                    {% with profile=solution.profile %}
                                        {% include "solution_include.html" %}
                                    {% endwith %}
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="col-lg-12" id="solution_container">
                            </div>
                        {% endif %}
                    </div>
                    {% if not is_closed and not request.user.is_anonymous and not html_snapshot and request_profile.email_verified and request_profile.completed_profile_info %}
                        <div class="row" style="padding-left: 15px; padding-right: 15px;">
                            <div class="block sb_markdown sb_solution sb_provide_solution">
                                <form id="solutionSubmitForm">
                                <div class="row-fluid">
                                    <h5>Provide a Solution</h5>
                                </div>
                                <div class="row">
                                    <div class="col-lg-12">
                                        <textarea class="form-control sb_solution_input_area markdown-input"
                                                  id="solution_content_id"
                                                  name="solution_content"
                                                  placeholder="Write your solution..."></textarea>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-4">
                                        <button class="btn btn-primary sb_btn sb_btn_fill submit_solution-action"
                                                id="submit_solution"
                                                data-object_uuid="{{ uuid }}"
                                                data-url="/solutions/submit_solution_api/">
                                            Submit
                                        </button>
                                    </div>
                                </div>
                                </form>
                            </div>
                        </div>
                    {% endif %}
                    {% if request.user.is_anonymous  %}
                        <div class="row">
                            <div class="col-md-4">
                                <button class="btn sb_restricted sb_btn_disabled"
                                        data-toggle="tooltip"
                                        data-placement="top"
                                        data-title="Signup to Provide a Solution">
                                    Submit Solution
                                </button>
                            </div>
                        </div>
                    {% elif not request_profile.email_verified %}
                        <div class="row">
                            <div class="col-md-4">
                                <button class="btn sb_restricted sb_btn_disabled"
                                        data-toggle="tooltip"
                                        data-placement="top"
                                        data-title="Please Verify Your Email">
                                    Submit Solution
                                </button>
                            </div>
                        </div>
                    {% elif not request_profile.completed_profile_info %}
                        <div class="row">
                            <div class="col-md-4">
                                <button class="btn sb_restricted sb_btn_disabled"
                                        data-toggle="tooltip"
                                        data-placement="top"
                                        data-title="Please Complete Registration">
                                    Submit Solution
                                </button>
                            </div>
                        </div>
                    {% endif %}
                {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
<div id="fileModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="btn btn-sm sb_btn close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                <h3 id="fileModalLabel">Upload Images</h3>
            </div>
            <div class="modal-form">
                <div class="tabbable tabs-left">
                    <ul class="nav nav-tabs">
                        <li class="active"><a href="#tab1" data-toggle="tab">Upload</a></li>
                        <li><a href="#tab2" data-toggle="tab">Enter URL</a></li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane active" id="tab1">
                            <div class="preview" id="preview" >
                                <input id="upload_image" type="file" name="img">
                            </div>
                        </div>
                        <div class="tab-pane" id="tab2">
                            <p><input type="text" class="form-control input-lg img-url" placeholder="Ex: http://yoursite.com/image.jpg" id="img-url" /></p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                            <div class="col-lg-4 col-md-6 col-sm-12 col-xs-12">
                    <button class="btn btn-primary sb_btn sb_btn_fill" id="insert_image_post">Insert Image</button>
                </div>
                <div class="col-lg-4 col-md-6 col-sm-12 col-xs-12">
                    <button class="btn btn-primary sb_btn sb_btn_fill sb_btn_remove" data-dismiss="modal" aria-hidden="true">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>
{% include "conversation_side_content.html" %}
<div class="div_data_hidden"
     data-sort_by="uuid"
     data-question_uuid="{{ uuid }}"></div>
    {% include "flag_modal.html" %}
{% endblock content %}
{% block scripts %}

    {{ block.super }}

    {% if not html_snapshot %}
        <script src="{% static 'js/edit_question.js' %}"></script>
        <script src="{% static 'js/vendor/jquery.pagedown-bootstrap.combined.min.js' %}"></script>
        <script src="{% static 'js/flag_modal.js' %}"></script>
        <script src="{% static 'js/create_markdown.js' %}"></script>
        <script src="{% static 'js/solution_validator.js' %}"></script>
        <script src="{% static 'js/activate_tooltips.js' %}"></script>
    {% endif %}

{% endblock scripts %}