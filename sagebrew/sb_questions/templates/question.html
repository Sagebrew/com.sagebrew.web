{% load staticfiles %}
{% load humanize %}
{% comment %}
    This template is rendered into html through a view and then returned as a
    result to an endpoint that is called requesting existing posts and their
    comments. This template is not meant for normal inclusion in a initial
    render template.
{% endcomment %}
<div class="js-page-object" data-object_uuid="{{ object_uuid }}" style="display: None"></div>
<div class="sb_question_header">
    <div class="row">
        <div class="vote_count_large">
            <div class="col-lg-1 hidden-md hidden-sm hidden-xs sb_vote_wrapper_solution">
                {% include "vote.html" %}
            </div>
        </div>
        <div class="col-lg-10 col-sm-11 col-xs-12 sb-question-title">
            <h1 style="font-size:32px;">
                {{ title|linebreaksbr }}
            </h1>
        </div>
        <div class="col-md-1 hidden-sm hidden-xs sb-solution-controls">

                {% if request.user.username == profile.username %}
                    <button class="btn dropdown-toggle sb_btn_icon" type="button"
                            data-toggle="dropdown">
                        <span class="fa fa-cog sb_btn_icon_green_hover"></span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-right sb_post_dropdown"
                        role="menu" aria-labelledby="dropdown-menu">
                        <li role="presentation"><a class="sb_post_dropdown_menu show_edit_question-action"
                                                   data-object_uuid="{{ object_uuid }}"
                                                   type="submit">Edit</a>
                        </li>
                    </ul>
                {% else %}
                    {% if "flag" in request_profile.privileges %}
                        {% include "flag.html" %}
                    {% else %}
                        {% include "flag_restriction.html" %}
                    {% endif %}
                {% endif %}

        </div>
    </div>
    <div class="row">
        <div class="col-xs-12 col-lg-11 col-lg-offset-1">
            <div class="sb_question_body" id="sb_question_{{ object_uuid }}">
                <div class="sb_markdown{% if is_closed %} sb_blurred_content{% endif %}" id="sb_content_{{ object_uuid }}">
                    {% autoescape off %}
                        <div id="js-question-container">
                            {{ html_content }}
                        </div>

                    {% endautoescape %}
                </div>
            </div>
        </div>

    </div>
    <div class="row">

        <div class="col-md-2 hidden-xs hidden-sm col-lg-offset-1">
            {% if request.user.is_anonymous %}
                <div><small>
                    <span class="sb_comment_disabled" data-toggle="tooltip"
                          data-placement="top"
                          data-title="Signup to Comment!"
                          id="post_comment_on_{{ object_uuid }}">
                        comment
                    </span>
                </small></div>
            {% elif "comment" in request_profile.privileges or "beta_user" in request_profile.privileges %}
            {% else %}
                <div><small>
                    <span class="sb_comment_disabled" data-toggle="tooltip"
                          data-placement="top"
                          data-title="Requirement: 20+ Rep"
                          id="post_comment_on_{{ object_uuid }}">
                        comment
                    </span>
                </small></div>
            {% endif %}
        </div>
    </div>
    {% if html_snapshot %}
        {% for comment in comments %}
            {% include "comment_include.html" %}
        {% endfor %}
    {% else %}
        <div id="sb_comments_container_{{ object_uuid }}">
            {% comment %}
                Dynamically populated by JS to show existing comments.
            {% endcomment %}
        </div>
    {% endif %}

    <div class="row">
        {% if not html_snapshot %}
            {% if "comment" in request_profile.privileges and not is_closed and not request.user.is_anonymous %}
                <form id="commentSubmitForm">
                <div class="input-group sb_comment">
                        <textarea class="input-group form-control sb_comment_input"
                                  id="post_comment_on_{{ object_uuid }}"
                                  rows="2"
                                  name="comment_content"
                                  placeholder="Help improve the Question by providing feedback or by requesting clarification..."></textarea>
                        <a class="btn input-group-btn sb_btn_comment_icon comment-action comment_{{ object_uuid }}"
                           data-object_uuid="{{ object_uuid }}"><span class="fa fa-plus"></span></a>
                    </div>
                </form>
            {% endif %}
        {% endif %}
    </div>
</div>